<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Repas Convivial</title>
  <style>
    body { font-family: sans-serif; background: #f0f8ff; padding: 20px; }
    h1 { color: #1e90ff; }
    .day { margin: 10px 0; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px #ccc; }
    textarea { width: 100%; height: 50px; }
    input[type="checkbox"] { margin-right: 8px; }
  </style>
</head>
<body>
  <h1>Repas Convivial</h1>
  <div id="planning"></div>
  <h2>Reste dans le frigo / Propositions</h2>
  <div id="restes">
    <input type="checkbox" /><input type="text" /><br/>
    <input type="checkbox" /><input type="text" /><br/>
    <input type="checkbox" /><input type="text" /><br/>
    <input type="checkbox" /><input type="text" /><br/>
    <input type="checkbox" /><input type="text" /><br/>
  </div>
  <h2>Liste de courses</h2>
  <div id="courses">
    <input type="checkbox" /><input type="text" /><br/>
    <input type="checkbox" /><input type="text" /><br/>
    <input type="checkbox" /><input type="text" /><br/>
    <input type="checkbox" /><input type="text" /><br/>
    <input type="checkbox" /><input type="text" /><br/>
  </div>

  <script>
    const sheetId = "1cAcHJwjJDSh-OFEzePO8w2u61LUN3RjQF3TVpothqkA";
    const apiKey = "AIzaSyCvhSun_wThUxUJj5N2imsj0Ej4YyLU1WI";
    const range = "Planning!A1:N15";

    const planningContainer = document.getElementById("planning");

    async function fetchData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();
      displayData(data.values);
    }

    function displayData(rows) {
      planningContainer.innerHTML = "";
      rows.forEach((row, i) => {
        const div = document.createElement("div");
        div.className = "day";
        const label = row[0] || `Jour ${i + 1}`;
        const content = row[1] || "";
        div.innerHTML = `<strong>${label}</strong><br><textarea data-index="${i}">${content}</textarea>`;
        planningContainer.appendChild(div);
      });
    }

    async function saveData() {
      const updates = [];
      document.querySelectorAll("#planning textarea").forEach((textarea) => {
        const i = textarea.dataset.index;
        const label = document.querySelectorAll("#planning .day")[i].querySelector("strong").innerText;
        const value = textarea.value;
        updates.push([label, value]);
      });

      const body = {
        values: updates
      };

      await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?valueInputOption=USER_ENTERED&key=${apiKey}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });
    }

    setInterval(saveData, 10000); // toutes les 10 secondes
    fetchData();
  </script>
</body>
</html>
