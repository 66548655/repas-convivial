<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Repas Convivial</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fefefe;
      color: #333;
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #3d9970;
    }
    .logo {
      width: 50px;
      vertical-align: middle;
    }
    h2 {
      color: #0074D9;
      border-bottom: 2px solid #7FDBFF;
      padding-bottom: 5px;
    }
    .day {
      margin-bottom: 10px;
      padding: 10px;
      background: #f0f8ff;
      border-radius: 10px;
    }
    textarea {
      width: 100%;
      min-height: 50px;
      margin-top: 5px;
      font-size: 16px;
      padding: 5px;
    }
    .section {
      margin-top: 20px;
      padding: 10px;
      background: #fffbe6;
      border: 1px solid #ffdc00;
      border-radius: 10px;
    }
    .checkbox-list label {
      display: block;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1><img src="https://img.icons8.com/emoji/48/fork-and-knife-with-plate-emoji.png" class="logo"/> Repas Convivial</h1>

  <div id="planning"></div>

  <div class="section">
    <h2>Reste dans le frigo / Propositions</h2>
    <div id="reste" class="checkbox-list"></div>
  </div>

  <div class="section">
    <h2>Liste de courses</h2>
    <div id="courses" class="checkbox-list"></div>
  </div>

  <script>
    const sheetId = "1cAcHJwjJDSh-OFEzePO8w2u61LUN3RjQF3TVpothqkA";
    const apiKey = "AIzaSyCvhSun_wThUxUJj5N2imsj0Ej4YyLU1WI";

    const days = [
      "Vendredi 25 juillet", "Samedi 26 juillet", "Dimanche 27 juillet", "Lundi 28 juillet",
      "Mardi 29 juillet", "Mercredi 30 juillet", "Jeudi 31 juillet", "Vendredi 1er août",
      "Samedi 2 août", "Dimanche 3 août", "Lundi 4 août", "Mardi 5 août",
      "Mercredi 6 août", "Jeudi 7 août"
    ];

    const planningDiv = document.getElementById("planning");

    function createTextarea(id, label) {
      const container = document.createElement("div");
      container.className = "day";

      const title = document.createElement("strong");
      title.textContent = label;
      container.appendChild(title);

      const textarea = document.createElement("textarea");
      textarea.id = id;
      textarea.placeholder = "Écris ici...";
      textarea.addEventListener("input", saveAll);
      container.appendChild(textarea);

      return container;
    }

    days.forEach((day) => {
      planningDiv.appendChild(createTextarea(`${day}-midi`, `${day} - midi`));
      planningDiv.appendChild(createTextarea(`${day}-soir`, `${day} - soir`));
    });

    function addCheckboxItem(container, prefix) {
      const index = container.children.length + 1;
      const id = `${prefix}-item-${index}`;
      const label = document.createElement("label");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.id = id;
      checkbox.addEventListener("change", saveAll);
      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = "Élément...";
      input.addEventListener("input", () => {
        saveAll();
        if (index === 5) addCheckboxItem(container, prefix);
      });
      label.appendChild(checkbox);
      label.appendChild(input);
      container.appendChild(label);
    }

    const resteDiv = document.getElementById("reste");
    const coursesDiv = document.getElementById("courses");
    for (let i = 0; i < 5; i++) {
      addCheckboxItem(resteDiv, "reste");
      addCheckboxItem(coursesDiv, "course");
    }

    function getAllData() {
      const data = {};
      days.forEach((day) => {
        data[`${day}-midi`] = document.getElementById(`${day}-midi`).value;
        data[`${day}-soir`] = document.getElementById(`${day}-soir`).value;
      });

      const reste = [];
      resteDiv.querySelectorAll("label").forEach((label) => {
        const input = label.querySelector("input[type='text']");
        const check = label.querySelector("input[type='checkbox']");
        if (input) reste.push(`${check.checked ? "[x]" : "[ ]"} ${input.value}`);
      });
      data["reste"] = reste.join("\n");

      const courses = [];
      coursesDiv.querySelectorAll("label").forEach((label) => {
        const input = label.querySelector("input[type='text']");
        const check = label.querySelector("input[type='checkbox']");
        if (input) courses.push(`${check.checked ? "[x]" : "[ ]"} ${input.value}`);
      });
      data["courses"] = courses.join("\n");

      return data;
    }

    function saveAll() {
      const data = getAllData();
      const values = [["Clé", "Contenu"]];
      for (const key in data) {
        values.push([key, data[key]]);
      }

      fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/A1:append?valueInputOption=RAW&key=${apiKey}`, {
        method: "POST",
        body: JSON.stringify({ values }),
        headers: { "Content-Type": "application/json" }
      });
    }
  </script>
</body>
</html>
